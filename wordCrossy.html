<HTML>
	<button type="button" onclick="newGame()"> New Game </button>
	<style>	
	table {
		border: 2px solid black;
	}
	th, td {
		padding: 15px;
		border: 2px solid black;
	}
	</style>

	<table id="gameBoard"> </table>
	<script language="JavaScript">
	var words = [["purple", "pulp", "rue", "pure"],["banish", "bash","nab", "bias"]];
	var locations = [["xxxxXxxxxxxXxxxxxxXxxxXXXXXXxXxXxxxxXxXxxxxXxxxxx","2,4,a", "5,1,d", "4,4,d", "2,4,d"], ["xxxXxxxxxXXXXxXxxXxxxXxxXxxxXXXXxxxxxxXxxxxxxxxxx", "4,1,d", "3,2,a", "1,3,d", "1,5,a"]];
	class gameState {
		constructor() {
			this.gameValue = 0;
			this.words =[["purple", "pulp", "rue", "pure"],["banish", "bash","nab", "bias"]];
			this.locations =[["xxxxXxxxxxxXxxxxxxXxxxXXXXXXxXxXxxxxXxXxxxxXxxxxx","2,4,a", "5,1,d", "4,4,d", "2,4,d"], ["xxxXxxxxxXXXXxXxxXxxxXxxXxxxXXXXxxxxxxXxxxxxxxxxx", "4,1,d", "3,2,a", "1,3,d", "1,5,a"]];
			this.numRows = 7;
			this.numColumns = 7;
			this.maxLetters = 6;
		}
	}

	function newGame() {
		var paletteCells = document.getElementById("palette").rows[0].cells;
		var letters = document.getElementById("lettersTable").rows[0].cells;
		var allLetters = "";
		for(var i=0; i<paletteCells.length; i++) {
			paletteCells[i].innerHTML = "";
		}
		//Gather all letters
		for(var allLetterCount =0; allLetterCount<letters.length; allLetterCount++) {
			allLetters += letters[i].innerHTML;
		}
		var sortedLetters = allLetters.split('').sort();
		for(var letterCount = 0; letterCount<letters.length; letterCount++) {
			letters[i].innerHTML = sortedLetters[i];
		}
	}

	function drawGameBoard(gameState) {
		//Draw Game Board
		var gameBoard = document.getElementById("gameBoard");
		var locationsMatrix = locations[gameState.gameValue][0].split('');
		for(var rowCount = gameState.numRows; rowCount > 0; rowCount--)
			{
				var row = gameBoard.insertRow(0);
				for(var columnCount = gameState.numColumns; columnCount > 0; columnCount--)
				{
					var cell1 = row.insertCell(0);
					cell1.innerHTML = (columnCount.toString()) + "," + (rowCount.toString());
					cell1.coords = [columnCount, rowCount];
					cell1.totalIndex = columnCount + (rowCount -1) * gameState.numRows;
					//Check the locations matrix and see if there is an "X" in the same postion. Subtract 1 from the total index because the location array starts at index 0 but coords start at 1
					if(locationsMatrix[cell1.totalIndex - 1] === "X")
					{
						cell1.innerHTML = "";
					}
					else {
						cell1.style.backgroundColor = "#000000";	
					}
				}	
			}
			
	}
	</script>

	<table id="lettersTable"></table>

	<table id="palette"></table>
	<button type="button" id="shuffle" onclick="shuffleLetters()"> Shuffle </button>
	<button type="button" id="place"> Place </button>
	<button type="button" id="delete"> Delete </button>
	<script>
	function drawLetterTable() {
		//Draw Letter Table
		var maxLetters = 6;
		var table = document.getElementById("lettersTable");
		var row = table.insertRow(0);
		row.id = "cells";
		var lettersArray = [];
		for(var letterCount = 0; letterCount < maxLetters; letterCount++)
		{
			var cell1 = row.insertCell(letterCount);
			cell1.onclick = cellOnClick;
			lettersArray = [...lettersArray, cell1];
		}	
		return lettersArray;
	}

	function drawGuessingPalette() {
		var paletteSize = 7;
		var paletteTable = document.getElementById("palette");
		var paletteRow = paletteTable.insertRow(0);
		for(var i = 0; i < paletteSize; i++) {
			var paletteCell = paletteRow.insertCell(i);
		}
	}

	function findFirstEmptyCell(cells) {
		var count = 0;
		var firstEmptyIndex;
		while(cells[count].innerHTML !== ""){
			count++
		}
		firstEmptyIndex = count;
		return firstEmptyIndex;
	}

	function cellOnClick() {
		var paletteCells = document.getElementById("palette").rows[0].cells;
		var firstEmptyIndex = findFirstEmptyCell(paletteCells)
		paletteCells[firstEmptyIndex].innerHTML = this.innerHTML;
		this.innerHTML = "";
	}
	function setupLetters(letterCells, words, gameValue) {
		var allLetters = words[gameValue][0];
		//Sort letters alphabetically for when tbe game starts
		var sortedLetters = allLetters.split('').sort().join('');
		for(var i = 0; i < letterCells.length; i++)
		{		
			letterCells[i].innerHTML = sortedLetters[i];
		}
	}
	
	function createGame() {
		var gameData = new gameState();
		gameData.gameValue = Math.floor(Math.random() * words.length);
		drawGameBoard(gameData);
		var letters = drawLetterTable();
		setupLetters(letters, gameData.words, gameData.gameValue);
		drawGuessingPalette();
		var placeButton = document.getElementById("place");
		placeButton.gameValue = gameData.gameValue;
		placeButton.locations = gameData.locations;
		placeButton.words = gameData.words;
		placeButton.wordCount = 0;
		placeButton.correctWords = [];
		placeButton.onclick = tryPlace;
		var deleteButton = document.getElementById("delete");
		deleteButton.onclick = deleteLetter;
		}

	function shuffleLetters() {
		var lettersCells = document.getElementById("cells").cells;
		var currentIndex = lettersCells.length;
		var temporaryValue;
		var randomIndex;
		//Shuffle by swapping with a random index
		while(0 !== currentIndex) {
			randomIndex = Math.floor(Math.random() * currentIndex);
			currentIndex -=1;

			temporaryValue = lettersCells[currentIndex].innerHTML;
			lettersCells[currentIndex].innerHTML = lettersCells[randomIndex].innerHTML;
			lettersCells[randomIndex].innerHTML = temporaryValue;
		}
	}

	function tryPlace() {
		var paletteCells = document.getElementById("palette").rows[0].cells;
		var gameBoard = document.getElementById("gameBoard");
		var attemptedWord = '';
		for(var i=0; i < paletteCells.length; i++){
			attemptedWord += paletteCells[i].innerHTML;
		}

		if((words[this.gameValue].includes(attemptedWord)) && !(this.correctWords.includes(attemptedWord))) {
			//Place word
			var wordChoice = this.words[this.gameValue].indexOf(attemptedWord);
			var locationCoords = this.locations[this.gameValue][wordChoice + 1].split(',');
			var rowIndex = locationCoords[1] -1;
			var columnIndex = locationCoords[0] -1;
			var direction = locationCoords[2];
			if(direction === 'a') {
				
				for(i=0;i<attemptedWord.length;i++) {
					gameBoard.rows[rowIndex].cells[columnIndex + i].innerHTML = attemptedWord[i];
					//clear one letter of the palette and put it back in letter box
					deleteLetter();
				}
			}
			else if(direction === 'd') {
				for(i=0;i<attemptedWord.length;i++) {
					gameBoard.rows[rowIndex + i].cells[columnIndex].innerHTML = attemptedWord[i];
					//clear one letter of the palette and put it back in letter box
					deleteLetter();
				}
			}

			else {
				alert("Dev Error: Invalid direction. Use 'a' or 'd' " );
				//Dev Error, incorrect location values
			}
			this.wordCount++
			if(this.wordCount === this.words[this.gameValue].length) {
				alert("game finished!");
				this.disabled = true;
				var deleteButton = document.getElementById("delete").disabled = true;
				var shuffleButton = document.getElementById("shuffle").disabled = true;
			}
			this.correctWords.push(attemptedWord);
			alert("Correct");
		}
		else {
			alert("Incorrect!");
		}
	}
	function deleteLetter() {
		var paletteCells = document.getElementById("palette").rows[0].cells;
		var lettersCells = document.getElementById("lettersTable").rows[0].cells;
		//Find the empty spaces in the letter box and guessing palette
		var firstEmptyLettersIndex = findFirstEmptyCell(lettersCells);
		var firstEmptyPaletteIndex = findFirstEmptyCell(paletteCells);
		//Move the last letter from the palette to the letter box
		lettersCells[firstEmptyLettersIndex].innerHTML = paletteCells[firstEmptyPaletteIndex-1].innerHTML;
		//Delete the last letter from the palette
		paletteCells[firstEmptyPaletteIndex-1].innerHTML = "";

	}

	window.onload = createGame();
	</script>


</HTML>
